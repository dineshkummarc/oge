oge.Bodies=function(a,b,c){function f(a,b){var c=function(b){var c,e,f,g,h,i,j,k=[],l=d.getBodies(a);for(e=0;e<l.length;e++)i=l[e],i!==a&&i.intersects(a)&&k.push(i);c=0,g=a.x+b.cos*1.9<<0,g!==a.x&&(g=a.x+(g>a.x?1:-1)),h=a.y+b.sin*1.9<<0,h!==a.y&&(h=a.y+(h>a.y?1:-1)),l=d.getBodies(g,h,a.width,a.height);for(e=0;e<l.length;e++){i=l[e];if(i!==a&&i.intersects(g,h,a.width,a.height)){j=!1;for(f=0;f<k.length;f++)if(i===k[f]){j=!0;break}j||(c+=i.intersection(g,h,a.width,a.height))}}return c<<0},e=c(b.clone().rotate(-45)),f=c(b.clone().rotate(45));e<f?moveBody(a,b.clone().rotate(-90),1):e>f&&moveBody(a,b.clone().rotate(90),1)}function g(a,b,c,d,e){return arguments.length===2&&(c=b.y,d=b.width,e=b.height,b=b.x),a.x<b+d&&a.x+a.width>b&&a.y<c+e&&a.y+a.height>c}function h(a,b,c,d,e){return arguments.length===2&&(c=b.y,d=b.width,e=b.height,b=b.x),sx=a.x>b?a.x:b,ex=a.x+a.width<b+d?a.x+a.width:b+d,sy=a.y>c?a.y:c,ey=a.y+a.height<c+e?a.y+a.width:c+e,(ex-sx)*(ey-sy)}var d=this,e={};d.width=a,d.height=b,d.onCollision=function(a,b){e[a]||(e[a]=[]),e[a].push(b)},d.moveBody=function(a,b,h){var i,j,k,l,m,n,o,p;arguments.length===1&&(b=a.direction,h=a.speed);for(n=0;n<h;n++){i=a.x,j=a.y,c.removeBody(c,a),a.x+=b.cos,a.y+=b.sin;if(a.x>=0&&a.x+a.width<d.width&&a.y>=0&&a.y+a.height<d.height){m=c.getBodies(a);for(o=0;o<m.length;o++){k=m[o];if(a!==k&&!g(k,i,j,a.width,a.height)&&g(k,a)){if(e[a]){l={body1:a,body2:k};for(p=0;p<e[a].length;p++)e[a][p](l)}a.x=i,a.y=j,c.addBody(c,a);if(a.slide&&o>=0)f(a,b);else return}}}else a.x=a.x<0?0:a.x,a.x=a.x+a.width>d.width?d.width-a.width:a.x,a.y=a.y<0?0:a.y,a.y=a.y+a.height>d.height?d.height-a.height:a.y;c.addBody(c,a)}},d.rotate=function(a,b){if(typeof a=="object"){var c=b*(Math.PI/180);a.cos=Math.cos(Math.acos(a.cos)+c),a.sin=Math.sin(Math.asin(a.sin)+c)}}};var oge={version:.9};oge.World=function(a,b,c){var d=this,e=new oge.Zones(a,b,c),f=new oge.Bodies(e),g=[];c=typeof c!="undefined"?c:10,d.width=a,d.height=b,d.step=function(a){var b,c;a=arguments.length===0?1:a;for(step=0;step<a;step++)for(b=0;b<g.length;b++)c=g[b],c.speed>0&&typeof c.direction=="object"&&f.moveBody(c)},d.addBody=function(a,b){return e.addBody(a)?(b&&g.push(a),!0):!1},d.removeBody=function(a){var b;e.removeBody(a);for(b=0;b<g.length;b++)if(g[b]===a){g.splice(b,1);break}}},oge.Zones=function(a,b,c){function f(a,b,f,g){var h,i,j,k,l=[];arguments.length===1&&(b=a.y,f=a.width,g=a.height,a=a.x);if(a>=0&&a+f-1<d.width&&b>=0&&b+g-1<d.height){h=Math.floor(a/c),i=Math.floor((a+f)/c),j=Math.floor(b/c),k=Math.floor((b+g)/c);for(a=h;a<=i;a++)for(b=j;b<=k;b++)l.push(e[a][b])}return l}var d=this,e=[];d.width=a,d.height=b,function(){var d,f,g=Math.floor(a/c+1),h=Math.floor(b/c+1);for(d=0;d<g;d++){e[d]=[];for(f=0;f<h;f++)e[d][f]={bodies:[]}}return e}(),d.addBody=function(a){var b,c=f(a);for(b=0;b<c.length;b++)c[b].bodies.push(a);return c.length>0},d.removeBody=function(a){var b,c,d=f(a);for(b=0;b<d.length;b++)for(c=0;c<d[b].bodies.length;c++)if(d[b].bodies[c]===a){d[b].bodies.splice(c,1);break}},d.getBodies=function(a,b,c,e){var g,h,i,j,k,l,m,n=[];arguments.length===1&&(b=a.y,c=a.width,e=a.height,a=a.x),a=a<0?0:a,a=a+c>d.width?d.width-c:a,b=b<0?0:b,b=b+e>d.height?d.height-e:b,g=f(a,b,c,e);for(k=0;k<g.length;k++){h=g[k].bodies;for(l=0;l<h.length;l++){i=h[l],j=!1;for(m=0;m<n.length;m++)if(n[m]===i){j=!0;break}j||n.push(i)}}return n}}