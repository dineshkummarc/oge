var OGE={};OGE.Direction=function(m,n){this.cos=typeof m!="undefined"?m:0;this.sin=typeof n!="undefined"?n:0;this.rotate=function(f){f=f*(Math.PI/180);this.cos=Math.cos(Math.acos(this.cos)+f);this.sin=Math.sin(Math.asin(this.sin)+f);return this};this.clone=function(){return new OGE.Direction(this.cos,this.sin)}};
OGE.Zone=function(m,n){this.x=typeof m!="undefined"?m:0;this.y=typeof n!="undefined"?n:0;this.bodies=[];this.addBody=function(f){for(var g=0;g<this.bodies.length;g++)if(this.bodies[g]===f)return;this.bodies.push(f)};this.removeBody=function(f){for(var g=0;g<this.bodies.length;g++)if(this.bodies[g]===f){this.bodies.splice(g,1);break}}};
OGE.Body=function(m,n,f,g){this.x=typeof m!="undefined"?m:0;this.y=typeof n!="undefined"?n:0;this.width=typeof f!="undefined"?f:1;this.height=typeof g!="undefined"?g:1;this.speed=0;this.direction=null;this.active=this.slide=false;var r=[];this.clearEvents=function(){r=[]};this.onCollision=function(h){r.push(h)};this.collide=function(h){for(var k=true,o=0;o<r.length;o++)if(r[o](h)===false)k=false;return k};this.intersects=function(h,k,o,s){var a;a=h;if(arguments.length===1){a=h.x;k=h.y;o=h.width;s=
h.height}return this.x<a+o&&this.x+this.width>a&&this.y<k+s&&this.y+this.height>k};this.intersection=function(h,k,o,s){var a;a=h;if(arguments.length===1){a=h.x;k=h.y;o=h.width;s=h.height}return((this.x+this.width<a+o?this.x+this.width:a+o)-(this.x>a?this.x:a))*((this.y+this.height<k+s?this.y+this.width:k+s)-(this.y>k?this.y:k))}};
OGE.World=function(m,n,f){this.width=typeof m!="undefined"?m:640;this.height=typeof n!="undefined"?n:480;this.zoneSize=typeof f!="undefined"?f:10;this.activeBodies=[];m=m/this.zoneSize+1<<0;n=n/this.zoneSize+1<<0;this.zones=[];var g=this;for(f=0;f<m;f++){this.zones[f]=[];for(var r=0;r<n;r++)this.zones[f][r]=new OGE.Zone(f,r)}this.addBody=function(a,b){if(h(a)!==true)return false;if(arguments.length>=2)a.active=b;a.active&&g.activeBodies.push(a);return true};this.removeBody=function(a){k(a);for(var b=
0;b<g.activeBodies.length;b++)if(g.activeBodies[b]===a){g.activeBodies.splice(b,1);break}};this.getBodies=function(a,b,e,i){var c,d;c=d=a;if(arguments.length===1){d=c.x;b=c.y;e=c.width;i=c.height}d=d<0?0:d;d=d+e>this.width?this.width-e:d;b=b<0?0:b;b=b+i>this.height?this.height-i:b;c=[];d=this.getZones(d,b,e,i);for(var l=0;l<d.length;l++)for(var p=d[l].bodies,j=0;j<p.length;j++){for(var q=p[j],u=false,t=0;t<c.length;t++)if(c[t]===q){u=true;break}u||c.push(q)}return c};this.getZones=function(a,b,e,
i){var c,d;c=d=a;if(arguments.length===1){d=c.x;b=c.y;e=c.width;i=c.height}if(d>=0&&d+e-1<this.width&&b>=0&&b+i-1<this.height){c=(d+e)/this.zoneSize<<0;var l=b/this.zoneSize<<0,p=(b+i)/this.zoneSize<<0,j=0,q=[];for(d=d/this.zoneSize<<0;d<=c;d++)for(b=l;b<=p;b++)q[j++]=this.zones[d][b];return q}else return[]};this.step=function(a){a=arguments.length===0?1:a;for(var b=0;b<a;b++)for(var e=0;e<this.activeBodies.length;e++){var i=this.activeBodies[e];i.speed>0&&i.direction!==null&&o(i)}};var h=function(a){var b=
g.getZones(a);if(b.length===0)return false;for(var e=0;e<b.length;e++)b[e].addBody(a);return true},k=function(a){for(var b=g.getZones(a),e=0;e<b.length;e++)b[e].removeBody(a)},o=function(a,b,e){var i,c,d;if(arguments.length===1){b=a.direction;e=a.speed}for(var l=0;l<e;l++){i=a.x;c=a.y;k(a);a.x+=b.cos;a.y+=b.sin;d=g.getBodies(a);for(var p=0;p<d.length;p++){var j=d[p];if(a!==j&&!j.intersects(i,c,a.width,a.height)&&j.intersects(a)){var q=a.collide(j)===true;j=j.collide(a)===true;if(q&&j){a.x=i;a.y=c;
h(a);if(a.slide&&p>=0)s(a,b);else return}}}h(a)}},s=function(a,b){var e=function(c){var d=0,l=a.x+c.cos*1.9<<0;if(l!==a.x)l=a.x+(l>a.x?1:-1);c=a.y+c.sin*1.9<<0;if(c!==a.y)c=a.y+(c>a.y?1:-1);for(var p=g.getBodies(l,c,a.width,a.height),j=0;j<p.length;j++){var q=p[j];if(q!==a&&q.intersects(l,c,a.width,a.height))d+=q.intersection(l,c,a.width,a.height)}return d<<0},i=e(b.clone().rotate(-45));e=e(b.clone().rotate(45));if(i<e)o(a,b.clone().rotate(-90),1);else i>e&&o(a,b.clone().rotate(90),1)}};
