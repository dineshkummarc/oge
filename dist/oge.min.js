var OGE={};OGE.Direction=function(l,m){this.cos=typeof l!="undefined"?l:0;this.sin=typeof m!="undefined"?m:0;this.rotate=function(f){f=f*(Math.PI/180);this.cos=Math.cos(Math.acos(this.cos)+f);this.sin=Math.sin(Math.asin(this.sin)+f);return this};this.clone=function(){return new OGE.Direction(this.cos,this.sin)}};
OGE.Zone=function(l,m){this.x=typeof l!="undefined"?l:0;this.y=typeof m!="undefined"?m:0;this.bodies=[];this.addBody=function(f){for(var g=0;g<this.bodies.length;g++)if(this.bodies[g]===f)return;this.bodies.push(f)};this.removeBody=function(f){for(var g=0;g<this.bodies.length;g++)if(this.bodies[g]===f){this.bodies.splice(g,1);break}}};
OGE.Body=function(l,m,f,g){this.x=typeof l!="undefined"?l:0;this.y=typeof m!="undefined"?m:0;this.width=typeof f!="undefined"?f:1;this.height=typeof g!="undefined"?g:1;this.speed=0;this.direction=null;this.active=this.slide=false;var r=[];this.clearEvents=function(){r=[]};this.onCollision=function(h){r.push(h)};this.collide=function(h){for(var k=true,n=0;n<r.length;n++)if(r[n](h)===false)k=false;return k};this.intersects=function(h,k,n,s){var a;a=h;if(arguments.length===1){a=h.x;k=h.y;n=h.width;s=
h.height}return this.x<a+n&&this.x+this.width>a&&this.y<k+s&&this.y+this.height>k};this.intersection=function(h,k,n,s){var a;a=h;if(arguments.length===1){a=h.x;k=h.y;n=h.width;s=h.height}return((this.x+this.width<a+n?this.x+this.width:a+n)-(this.x>a?this.x:a))*((this.y+this.height<k+s?this.y+this.width:k+s)-(this.y>k?this.y:k))}};
OGE.World=function(l,m,f){this.width=typeof l!="undefined"?l:640;this.height=typeof m!="undefined"?m:480;this.zoneSize=typeof f!="undefined"?f:10;this.activeBodies=[];l=l/this.zoneSize+1<<0;m=m/this.zoneSize+1<<0;this.zones=[];var g=this;for(f=0;f<l;f++){this.zones[f]=[];for(var r=0;r<m;r++)this.zones[f][r]=new OGE.Zone(f,r)}this.addBody=function(a,b){if(h(a)!==true)return false;if(arguments.length>=2)a.active=b;a.active&&g.activeBodies.push(a);return true};this.removeBody=function(a){k(a);for(var b=
0;b<g.activeBodies.length;b++)if(g.activeBodies[b]===a){g.activeBodies.splice(b,1);break}};this.getBodies=function(a,b,c,i){var e,d;e=d=a;if(arguments.length===1){d=e.x;b=e.y;c=e.width;i=e.height}d=d<0?0:d;d=d+c>this.width?this.width-c:d;b=b<0?0:b;b=b+i>this.height?this.height-i:b;e=[];d=this.getZones(d,b,c,i);for(var o=0;o<d.length;o++)for(var p=d[o].bodies,j=0;j<p.length;j++){for(var q=p[j],u=false,t=0;t<e.length;t++)if(e[t]===q){u=true;break}u||e.push(q)}return e};this.getZones=function(a,b,c,
i){var e,d;e=d=a;if(arguments.length===1){d=e.x;b=e.y;c=e.width;i=e.height}if(d>=0&&d+c-1<this.width&&b>=0&&b+i-1<this.height){e=(d+c)/this.zoneSize<<0;var o=b/this.zoneSize<<0,p=(b+i)/this.zoneSize<<0,j=0,q=[];for(d=d/this.zoneSize<<0;d<=e;d++)for(b=o;b<=p;b++)q[j++]=this.zones[d][b];return q}else return[]};this.step=function(a){a=arguments.length===0?1:a;for(var b=0;b<a;b++)for(var c=0;c<this.activeBodies.length;c++){var i=this.activeBodies[c];i.speed>0&&i.direction!==null&&n(i)}};var h=function(a){var b=
g.getZones(a);if(b.length===0)return false;for(var c=0;c<b.length;c++)b[c].addBody(a);return true},k=function(a){for(var b=g.getZones(a),c=0;c<b.length;c++)b[c].removeBody(a)},n=function(a,b,c){var i,e,d;if(arguments.length===1){b=a.direction;c=a.speed}for(var o=0;o<c;o++){i=a.x;e=a.y;k(a);a.x+=b.cos;a.y+=b.sin;d=g.getBodies(a);for(var p=0;p<d.length;p++){var j=d[p];if(a!==j&&!j.intersects(i,e,a.width,a.height)&&j.intersects(a)){var q=a.collide(j)===true;j=j.collide(a)===true;if(q&&j){a.x=i;a.y=e;
h(a);if(a.slide&&c-p>0)s(a,b);else return}}}h(a)}},s=function(a,b){var c=function(e){var d=0,o=a.x+e.cos*1.9;e=a.y+e.sin*1.9;for(var p=g.getBodies(o,e,a.width,a.height),j=0;j<p.length;j++){var q=p[j];if(q!==a&&q.intersects(o,e,a.width,a.height))d+=q.intersection(o,e,a.width,a.height)}return d<<0},i=c(b.clone().rotate(-45));c=c(b.clone().rotate(45));if(i<c)n(a,b.clone().rotate(-90),1);else i>c&&n(a,b.clone().rotate(90),1)}};
