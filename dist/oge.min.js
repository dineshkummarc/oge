var OGE={};Object.construct_prototype=function(j){var i=function(){};i.prototype=j.prototype;return new i};
OGE.World=function(j,i,h){this.width=typeof j!="undefined"?j:640;this.height=typeof i!="undefined"?i:480;this.zoneSize=typeof h!="undefined"?h:10;this.activeBodies=[];j=j/this.zoneSize+1<<0;i=i/this.zoneSize+1<<0;this.zones=[];var l=this;for(h=0;h<j;h++){this.zones[h]=[];for(var p=0;p<i;p++)this.zones[h][p]=new OGE.Zone(h,p)}this.addBody=function(a){if(q(a)!==true)return false;a.isActive()&&this.activeBodies.push(a);a.clearEvents();a.onActive(function(){l.activeBodies.push(a)});a.onDeactive(function(){for(var b=
0;b<l.activeBodies.length;b++)if(l.activeBodies[b]===a){l.activeBodies.splice(b,1);break}});return true};this.removeBody=function(a){r(a);for(var b=0;b<l.activeBodies.length;b++)if(l.activeBodies[b]===a){l.activeBodies.splice(b,1);break}};this.getBodies=function(a,b,c,e){var g,f;g=f=a;if(arguments.length===1){f=g.x;b=g.y;c=g.width;e=g.height}f=f<0?0:f;f=f+c>this.width?this.width-c:f;b=b<0?0:b;b=b+e>this.height?this.height-e:b;g=[];f=this.getZones(f,b,c,e);for(var m=0;m<f.length;m++)for(var n=f[m].bodies,
k=0;k<n.length;k++){for(var o=n[k],u=false,t=0;t<g.length;t++)if(g[t]===o){u=true;break}u||g.push(o)}return g};this.getZones=function(a,b,c,e){var g,f;g=f=a;if(arguments.length===1){f=g.x;b=g.y;c=g.width;e=g.height}if(f>=0&&f+c-1<this.width&&b>=0&&b+e-1<this.height){g=(f+c)/this.zoneSize<<0;var m=b/this.zoneSize<<0,n=(b+e)/this.zoneSize<<0,k=0,o=[];for(f=f/this.zoneSize<<0;f<=g;f++)for(b=m;b<=n;b++)o[k++]=this.zones[f][b];return o}else return[]};this.step=function(a){a=arguments.length===0?1:a;for(var b=
0;b<a;b++)for(var c=0;c<this.activeBodies.length;c++){var e=this.activeBodies[c];e.speed>0&&e.direction!==null&&s(e)}};var q=function(a){var b=l.getZones(a);if(b.length===0)return false;for(var c=0;c<b.length;c++)b[c].addBody(a);return true},r=function(a){for(var b=l.getZones(a),c=0;c<b.length;c++)b[c].removeBody(a)},s=function(a,b,c){var e,g,f;if(arguments.length===1){b=a.direction;c=a.speed}for(var m=0;m<c;m++){e=a.x;g=a.y;r(a);a.x+=b.cos;a.y+=b.sin;f=l.getBodies(a);for(var n=0;n<f.length;n++){var k=
f[n];if(a!==k&&!k.intersects(e,g,a.width,a.height)&&k.intersects(a)){var o=a.collide(k)===true;k=k.collide(a)===true;if(o&&k){a.x=e;a.y=g;q(a);if(a.slide&&c-n>0)d(a,b);else return}}}q(a)}},d=function(a,b){var c=function(g){var f=0,m=a.x+g.cos*1.9;g=a.y+g.sin*1.9;for(var n=l.getBodies(m,g,a.width,a.height),k=0;k<n.length;k++){var o=n[k];if(o!==a&&o.intersects(m,g,a.width,a.height))f+=o.intersection(m,g,a.width,a.height)}return f},e=c(b.clone().rotate(-45));c=c(b.clone().rotate(45));if(e<c)s(a,b.clone().rotate(-90),
1);else e>c&&s(a,b.clone().rotate(90),1)}};OGE.Direction=function(j,i){this.cos=typeof j!="undefined"?j:0;this.sin=typeof i!="undefined"?i:0;this.rotate=function(h){h=h*(Math.PI/180);this.cos=Math.cos(Math.acos(this.cos)+h);this.sin=Math.sin(Math.asin(this.sin)+h);return this};this.clone=function(){return new OGE.Direction(this.cos,this.sin)}};OGE.Direction.create=function(j,i,h,l){i=l-i;j=h-j;h=Math.sqrt(Math.pow(i,2)+Math.pow(j,2));return new OGE.Direction(j/h,i/h)};
OGE.Body=function(j,i,h,l){this.x=typeof j!="undefined"?j:0;this.y=typeof i!="undefined"?i:0;this.width=typeof h!="undefined"?h:1;this.height=typeof l!="undefined"?l:1;this.speed=0;this.direction=null;var p=this.slide=false,q=[],r=[],s=[];this.setDirection=function(d,a){this.direction=OGE.Direction.create(this.x,this.y,d,a)};this.clearEvents=function(){onActivate=[];r=[]};this.isActive=function(){return p};this.setActive=function(d){if(p!==d)if(p=d)for(d=0;d<q.length;d++)q[d]();else for(d=0;d<r.length;d++)r[d]()};
this.onActive=function(d){q.push(d)};this.onDeactive=function(d){r.push(d)};this.onCollision=function(d){s.push(d)};this.collide=function(d){for(var a=true,b=0;b<s.length;b++)if(s[b](d)===false)a=false;return a};this.intersects=function(d,a,b,c){var e;e=d;if(arguments.length===1){e=d.x;a=d.y;b=d.width;c=d.height}return this.x<e+b&&this.x+this.width>e&&this.y<a+c&&this.y+this.height>a};this.intersection=function(d,a,b,c){var e;e=d;if(arguments.length===1){e=d.x;a=d.y;b=d.width;c=d.height}return((this.x+
this.width<e+b?this.x+this.width:e+b)-(this.x>e?this.x:e))*((this.y+this.height<a+c?this.y+this.width:a+c)-(this.y>a?this.y:a))}};
